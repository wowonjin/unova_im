databases:
  - name: unova-classroom-db
    plan: free

services:
  - type: web
    name: unova-classroom
    env: node
    plan: free
    region: oregon
    rootDir: classroom
    buildCommand: npm ci && npm run build
    startCommand: node scripts/migrate-if-db.cjs && npm run start -- -p $PORT
    autoDeploy: true
    envVars:
      - key: NODE_VERSION
        value: 20.18.1
      - key: NODE_ENV
        value: production

      # DB
      # Use the same DB as local (set in Render dashboard).
      # Example: the DATABASE_URL from classroom/.env.local
      - key: DATABASE_URL
        sync: false

      # File storage (uploads)
      - key: STORAGE_ROOT
        value: /var/data

      # App-required envs (set these in Render dashboard after first deploy)
      - key: ADMIN_EMAILS
        sync: false
      - key: DEFAULT_USER_EMAIL
        sync: false
      - key: IMWEB_API_KEY
        sync: false
      - key: IMWEB_API_SECRET
        sync: false
      - key: IMWEB_WEBHOOK_TOKEN
        sync: false
      - key: IMWEB_WEBHOOK_SECRET
        sync: false
      - key: IMWEB_WEBHOOK_SIGNATURE_HEADER
        sync: false
      - key: IMWEB_WEBHOOK_HMAC_ALG
        sync: false
      - key: IMWEB_WEBHOOK_SIGNATURE_ENCODING
        sync: false
      - key: IMWEB_WEBHOOK_SIGNATURE_PREFIX
        sync: false
      - key: IMWEB_WEBHOOK_EVENTS
        sync: false
      - key: IMWEB_ACCESS_AFFILIATE
        sync: false
      - key: IMWEB_DEFAULT_MEMBER_CODE
        sync: false
      - key: NEXT_PUBLIC_EXIT_URL
        sync: false
      - key: NEXT_PUBLIC_KAKAO_CHAT_URL
        sync: false
      - key: UNOVA_TEST_SHOW_ALL_COURSES
        sync: false

      # Social Login (OAuth)
      - key: NEXT_PUBLIC_BASE_URL
        sync: false
      - key: KAKAO_REST_API_KEY
        sync: false
      - key: KAKAO_CLIENT_SECRET
        sync: false
      - key: NAVER_CLIENT_ID
        sync: false
      - key: NAVER_CLIENT_SECRET
        sync: false

      # Toss Payments
      - key: TOSS_CLIENT_KEY
        sync: false
      - key: TOSS_SECRET_KEY
        sync: false
      - key: TOSS_BILLING_CLIENT_KEY
        sync: false
      - key: TOSS_BILLING_SECRET_KEY
        sync: false

    disk:
      name: unova-classroom-storage
      mountPath: /var/data
      sizeGB: 1


